# 코드형 인프라란?

<br>

코드를 작성 및 실행하여 인프라를 생성, 배포, 수정, 정리하는 것

<br>

## 애드혹(ad hoc) 스크립트
자동화하는 가장 간단한 방법  
수행할 작업을 단계별로 나누고 bash, ruby, python 등 선호하는 언어를 사용하여 각 단계를 코드로 정의하고 작성된 스크립트를 서버에서 수동으로 실행

#### Bash example
setup-webserver.sh  
```bash
sudo apt-get update
sudo apt-get install -y php apache2
sudo git clone https://github.com/brikis98/php-app.git /var/www/html/app
sudo service apache2 start
```

### 단점
#### 코드를 직접 작성하여 수동으로 작업
범용 프로그래밍 언어를 사용하면 사용자가 매번 수동으로 맞춤 코드를 작성해야 하는 작업 필요  
코드형 인프라용으로 설계된 도구를 사용하면 이런 복잡한 작업을 간결한 API로 수행 가능하며, 대체로 코드에 정해진 구조가 적용

#### 범용 프로그래밍 언어를 사용할 때는 각 개발자가 자신만의 고유한 스타일로 작업
짧은 코드는 괜찮을 수 있지만 수십 개의 서버, 데이터베이스, 로드 밸런서, 네트워크 구성 등을 관리하는 경우에 문제 발생

<br>

## 구성 관리 도구
Chef, Puppet, Ansible, SaltStack 등은 대상 서버에 소프트웨어를 설치하고 관리하도록 설계되어 있는 구성 관리 도구

#### Ansible example
web-server.yml  
```yaml
- name: Update teh apt-get cache
  apt:
    update_cache: yes

- name: Install PHP
  apt:
    name: php

- name: Install Apache
  apt:
    name: apache2

- name: Copy the code from the repository
  git: repo=https://github.com/brikis98/php-app.git dest=/var/www/html/app

- name: Start Apache
  service: name=apache2 state=started enabled=yes
```
